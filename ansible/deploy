#!/bin/sh
#
# This is an Ansible playbook to do or redo all the things.
#
#
# Usage: this script expects to be invoked from the top
#        of the source tree.
#
# ./ansible/deploy
#
# ./ansible/deploy -l charte-wp-dcsl
#
#
# If you are unfamiliar with Ansible, read up on it at
# - https://www.ansible.com/overview/how-ansible-works
# - https://github.com/jdauphant/awesome-ansible

inventories="-i ansible/hosts-dev"
# One can override these overrides on the command line
default_plays="-e play_update=yes -e play_backup=yes -e play_create_or_restore=yes"

while [ -n "$1" ]; do
    case "$1" in
        --prod)
            inventories="$inventories -i ansible/hosts-prod"
            shift ;;
        *)
            break ;;
    esac
done

thisdir="$(dirname "$(realpath "$0")")"

ansible-playbook $default_plays $inventories "$@" "$thisdir"/playbooks/wordpress-main.yml
